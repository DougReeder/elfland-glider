<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Yggdrasil - Elfland Glider</title>
    <meta name="description" content="Travel to any of the worlds">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.0.14/howler.core.min.js"></script>
    <script src="https://rawgit.com/aframevr/aframe/a1a142f/dist/aframe-master.min.js"></script>
    <script src="../assets/look-fly-controls.js"></script>
    <script src="https://cdn.rawgit.com/DougReeder/aframe-button-controls/v1.0.0/aframe-button-controls.js"></script>
    <script src="../assets/elfland-utils.js"></script>
    <script src="https://unpkg.com/aframe-state-component@^3.2.4/dist/aframe-state-component.min.js"></script>
    <script src="../assets/state.js"></script>
    <script src="https://unpkg.com/aframe-simple-sun-sky@^1.2.0/simple-sun-sky.js"></script>
    <script src="https://unpkg.com/aframe-dust-component@^1.0.0/aframe-dust-component.js"></script>
    <script src="https://unpkg.com/aframe-aabb-collider-component@^2.2.1/dist/aframe-aabb-collider-component.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Niconne" rel="stylesheet">
    <script src="../assets/intro.js"></script>
    <script>
        AFRAME.registerComponent('yggdrasil', {
            init: function () {
                setEnvironmentalSound('Swell2b-64k.mp3', 0.3);

                this.positionSph = new THREE.Spherical(1, Math.PI/2, 0);
                this.position = new THREE.Vector3();
                this.sss = document.querySelector('a-simple-sun-sky');
                this.directional = document.getElementById('directional');

                if (sessionStorage.getItem('previousWorld') === '/island/') {
                    let prelaunchHelp = AFRAME.scenes[0].querySelector('#prelaunchHelp');
                    prelaunchHelp.setAttribute('value', "Congratulations!\\nYou've completed the main quests.\\nExplore all the worlds!");
                }
            },

            tick: function (time) {
                this.positionSph.phi = Math.PI * 0.5 + Math.sin(time / 120000 * 2 * Math.PI) * 0.8;
                this.positionSph.theta = Math.PI * 0.25 + Math.sin(time / 240000 * 2 * Math.PI) * 1;
                this.position.setFromSpherical(this.positionSph);
                let positionStr = this.position.x + ' ' + this.position.y + ' ' + this.position.z;
                this.sss.setAttribute('sun-position', positionStr);
                this.directional.setAttribute('position', positionStr);
            }
        })
    </script>
</head>
<body>
<a-scene yggdrasil cursor="rayOrigin: mouse">
    <a-assets>
        <img id="woodTexture" src="../assets/stabbur/textures/Stabbur_diffuse.png">
    </a-assets>

    <a-simple-sun-sky sun-position="1 1 1" fog-color="none"></a-simple-sun-sky>
    <a-entity light="type: ambient; color: #fff; intensity: 0.5"></a-entity>
    <a-entity id="directional" light="type: directional; color: #FFF; intensity: 1.0" position="0.7 0.4 -1"></a-entity>

    <a-dust num-points="1024" dispersion="100" color="white" point-size="2"></a-dust>

    <a-torus-knot  scale="0.3 10 0.4" radius="100" p="2" q="21" radius-tubular="4" src="#woodTexture" roughness="1" metalness="0"
            class="landscape"></a-torus-knot>
    <!--<a-cylinder id="yggdrasil" radius="10" height="5000" open-ended="true" src="#woodTexture"></a-cylinder>-->

    <a-entity id="islandPortal" position="0 0 -125" rotation="0 0 0" scale="5 5 0"
              link="href:../island; title: Island; image:../island/screenshot-island.png; on:hitstart"></a-entity>

    <a-entity id="archesPortal" position="125 0 0" rotation="0 -90 0" scale="5 5 0"
              link="href:../arches; title: Arches; image:../arches/screenshot-arches.png; on:hitstart"></a-entity>

    <a-entity id="canyonPortal" position="88 0 -88" rotation="0 -45 0" scale="5 5 0"
              link="href:../canyon; title: Canyon; on:hitstart"></a-entity>


    <a-entity id="charringtonPortal" position="-88 -20 88" rotation="0 -45 0" scale="5 5 0"
              link="href:https://dougreeder.github.io/webvr-tour/; title: Charrington Park; image:https://dougreeder.github.io/webvr-tour/CharringtonPark/CharringtonPark-CooperRoad.jpg; on:hitstart"></a-entity>

    <a-entity id="ginnungagapPortal" position="-125 -20 0" rotation="0 90 0" scale="5 5 0"
              link="href:../ginnungagap; title: Ginnungagap; image:../ginnungagap/screenshot-ginnungagap.png; on:hitstart"></a-entity>

    <!--<a-entity id="argonPortal" position="0 -20 125" rotation="0 -180 0" scale="5 5 0"-->
              <!--link="href:http://ansible.uk/misc/eyeargon.html; title: Eye of Argon; on:hitstart"></a-entity>-->

    <a-text id="prelaunchHelp" position="-25 17 25" rotation="0 -45 0" width="12" align="center" font="../assets/mozillavr.fnt" value=""></a-text>

    <a-entity id="armature" geometry="primitive: box; width: 2; height: 2; depth: 2" material="visible:false"
              bind__position="gliderPosition" bind__rotation.y="gliderRotationY" armature-tick-state
              aabb-collider="objects:[link]" >
        <a-entity id="glider" position="0 0 0" bind__rotation.x="gliderRotationX"
                  raycaster="objects:.landscape; far:0.5;">
            <a-entity id="headingTriangle" position="0 1.5 0"
                      geometry="primitive:triangle; vertexA:0 0 -4.25; vertexB:0.1 0 0; vertexC:-0.1 0 0;"
                      material="shader: flat; transparent:true; opacity:0.3; color:black;"></a-entity>
        </a-entity>
        <a-entity id="body">
            <a-entity camera="" look-fly-controls="">
                <a-text id="hud" position="0.2 0.42 -0.75" rotation="30 -20 0" width="2" align="center" value="HUD"
                        geometry="primitive:plane; width:0.14; height:0.1;"
                        material="color: gray; opacity: 0.7" bind__text="value: hudText" bind__visible="hudVisible"></a-text>
            </a-entity>
        </a-entity>
        <a-entity button-controls></a-entity>
    </a-entity>
</a-scene>
<!-- Copyright Â© 2017-2018 P. Douglas Reeder; Licensed under the GNU GPL-3.0 -->
</body>
</html>
