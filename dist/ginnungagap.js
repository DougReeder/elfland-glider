!function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=19)}({0:function(t,e,o){"use strict";function n(){if(!l())return;let t,e=document.querySelector("canvas.a-canvas"),o=e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen;o&&(t=o.apply(e)),t&&t.then||(t=Promise.resolve()),t.then(i,i)}function i(){screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape").then(t=>{console.log("screen orientation locked:",t)}).catch(t=>{console.warn("screen orientation didn't lock:",t)})}function r(){return!(AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR())}function l(){return AFRAME.utils.device.isMobile()&&!AFRAME.scenes[0].is("vr-mode")}function a(t,e,o){let n=t/180*Math.PI,i=o*Math.sin(n),r=o*Math.cos(n),l=e/180*Math.PI;return{x:r*Math.cos(l),y:i,z:-r*Math.sin(l)}}o.d(e,"c",function(){return n}),o.d(e,"d",function(){return r}),o.d(e,"e",function(){return l}),o.d(e,"b",function(){return a}),o.d(e,"g",function(){return c}),o.d(e,"f",function(){return d}),o.d(e,"a",function(){return u});var s=null;function c(t,e){s=new Howl({src:t,autoplay:!0,loop:!0,volume:e||1,html5:!1,onplayerror:function(){s.once("unlock",function(){s.play()})}})}function d(){s&&!s.playing()&&s.play()}function u(t,e){let o={x:(t.x+e.x)/2,y:(t.y+e.y)/2,z:(t.z+e.z)/2};return t.x-e.x>-.02&&(t={x:o.x-.01,y:t.y,z:t.z},e={x:o.x+.01,y:e.y,z:e.z}),{position:o,rotation:{x:0,y:-180*Math.atan2(e.z-t.z,e.x-t.x)/Math.PI,z:180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI}}}document.addEventListener("visibilitychange",()=>{s&&(document.hidden?s.pause():s.play())},!1)},1:function(t,e,o){"use strict";o(2);var n=o(0);AFRAME.registerState({initialState:{armatureEl:null,gliderEl:null,cameraEl:null,leftHandEl:null,rightHandEl:null,controllerConnections:{},isAnyPressedLeft:!1,isAnyPressedRight:!1,controlBarEl:null,controlNeutralHeight:.95,controlMode:"HEAD",controlSubmode:"NONE",time:0,difficulty:.6,gliderPosition:{x:-30,y:15,z:30},gliderPositionStart:{x:-30,y:15,z:30},gliderRotationX:0,gliderRotationY:-45,gliderRotationZ:0,gliderRotationYStart:-45,isFlying:!1,gliderSpeed:5,numYellowStars:Math.POSITIVE_INFINITY,stars:0,questComplete:!1,inventory:{},hudVisible:!0,hudText:"",controlsReminderDisplayed:!1,debug:!1},handlers:{setState:function(t,e){for(let o in e)"target"!==o&&(console.log("setting",o,e[o]),t[o]=e[o])},setArmatureEl:function(t,e){this.powerup=new Howl({src:["../assets/411460__inspectorj__power-up-bright-a.mp3"]}),console.log("hasNativeWebXRImplementation:",window.hasNativeWebXRImplementation),console.log("hasNativeWebVRImplementation:",window.hasNativeWebVRImplementation),console.log("isMobile:",AFRAME.utils.device.isMobile()),console.log("isMobileVR:",AFRAME.utils.device.isMobileVR()),t.armatureEl=e,t.gliderEl=e.querySelector("#glider"),t.cameraEl=e.querySelector("[camera]");let o=AFRAME.scenes[0].querySelector("a-dust");o&&requestIdleCallback(()=>{o.components.dust.setCamera(t.armatureEl)});let i=t.armatureEl.querySelector("#body"),r=t.gliderEl.querySelector("#wing"),l=e.querySelector("#hud");this.adjustForMagicWindow(r),AFRAME.scenes[0].is("vr-mode")&&AFRAME.utils.device.checkHeadsetConnected()?(this.adjustHudForVR(l),t.difficulty=.75):(this.adjustHudForFlat(l),Object(n.e)()?t.difficulty=.6:t.difficulty=.5),AFRAME.scenes[0].addEventListener("enter-vr",e=>{AFRAME.utils.device.checkHeadsetConnected()&&(i.object3D.position.y=-1.6,this.adjustHudForVR(l),this.adjustForMagicWindow(r),t.difficulty=.75),Object(n.f)()}),AFRAME.scenes[0].addEventListener("exit-vr",e=>{this.adjustHudForFlat(l),this.adjustForMagicWindow(r),Object(n.e)()?t.difficulty=.6:t.difficulty=.5}),Object(n.d)()&&!AFRAME.utils.device.checkHeadsetConnected()&&(console.log("desktop w/o headset; disabling look-controls so keyboard controls can function"),t.cameraEl.setAttribute("look-controls","enabled","false")),t.gliderEl.addEventListener("raycaster-intersection",e=>{if(e.detail.intersections.length>0&&e.detail.intersections[0].distance>0){console.log("CRASH!",e.detail.els[0].tagName,e.detail.intersections[0].distance,t.gliderEl.getAttribute("raycaster").far,t.gliderSpeed/4),AFRAME.scenes[0].emit("hover",{}),new Howl({src:["../assets/198876__bone666138__crash.mp3"]}).play(),setTimeout(()=>{t.gliderSpeed>=30?(sessionStorage.setItem("returnWorld",location.pathname),location.pathname="/ginnungagap/"):(t.gliderPosition.x=t.gliderPositionStart.x,t.gliderPosition.y=t.gliderPositionStart.y,t.gliderPosition.z=t.gliderPositionStart.z,t.gliderRotationX=0,t.gliderRotationY=t.gliderRotationYStart,t.gliderSpeed=5,t.hudText="",t.cameraEl.object3D.rotation.x=0,t.cameraEl.object3D.rotation.y=0,t.cameraEl.object3D.rotation.z=0,setTimeout(this.showControlsReminder.bind(this,t),3e3))},2e3)}}),e.addEventListener("hitstart",e=>{e.detail.intersectedEls.forEach(e=>{if(e.classList.contains("powerup"))console.log("powerup"),t.gliderSpeed+=16,this.powerup.play();else if(e.classList.contains("star"))++t.stars,console.log("collected star",t.stars,"of",t.numYellowStars),e.parentNode.removeChild(e),this.ding.play();else if(e.classList.contains("proximitySound")){let t=e.getAttribute("data-sound-url"),o=e.getAttribute("data-sound-volume")||1;t&&new Howl({src:t,volume:o,autoplay:!0});let n=e.getAttribute("data-text"),i=AFRAME.scenes[0].querySelector("#subtitle");n&&i&&(i.setAttribute("value",n),setTimeout(()=>{i.setAttribute("value","")},5e3))}else e.components.link&&(console.log("hit link"),"/ginnungagap/"!==location.pathname&&sessionStorage.setItem("previousWorld",location.pathname))})}),document.addEventListener("keydown",function(e){t.cameraEl.getAttribute("rotation");switch(e.code){case"KeyA":case"ArrowLeft":t.cameraEl.object3D.rotation.z+=.07;break;case"KeyD":case"ArrowRight":t.cameraEl.object3D.rotation.z-=.07;break;case"KeyW":case"ArrowUp":t.cameraEl.object3D.rotation.x+=.045;break;case"KeyS":case"ArrowDown":t.cameraEl.object3D.rotation.x-=.045;break;case"Space":t.isFlying?t.debug&&AFRAME.scenes[0].emit("hover",e):AFRAME.scenes[0].emit("launch",e);break;case"Enter":t.hudVisible=!t.hudVisible}},!1),t.leftHandEl=document.getElementById("leftHand"),t.rightHandEl=document.getElementById("rightHand"),Object(n.d)()&&(t.leftHandEl.setAttribute("hand-controls","handModelStyle","highPoly"),t.rightHandEl.setAttribute("hand-controls","handModelStyle","highPoly")),this.leftDownHandler=this.handHandler.bind(this,"LEFT","DOWN",t),this.leftUpHandler=this.handHandler.bind(this,"LEFT","UP",t),this.rightDownHandler=this.handHandler.bind(this,"RIGHT","DOWN",t),this.rightUpHandler=this.handHandler.bind(this,"RIGHT","UP",t),t.controlBarEl=document.getElementById("controlBar")},controllerconnected:function(t,e){t.controllerConnections[e.component.el.id]=!0,this.adjustControlMode(t)},controllerdisconnected:function(t,e){t.controllerConnections[e.component.el.id]=!1,this.adjustControlMode(t)},adjustControlMode:function(t){const e=t.controlMode;if(t.controllerConnections.leftHand||t.controllerConnections.rightHand?t.controlMode="HANDS":t.controlMode="HEAD",t.controlMode!==e)if(console.log("changed control mode from",e,"to",t.controlMode),"HANDS"===t.controlMode){t.leftHandEl.addEventListener("buttondown",this.leftDownHandler),t.leftHandEl.addEventListener("buttonup",this.leftUpHandler),t.rightHandEl.addEventListener("buttondown",this.rightDownHandler),t.rightHandEl.addEventListener("buttonup",this.rightUpHandler);const e=t.cameraEl.getAttribute("position");t.controlNeutralHeight=e.y-.56,t.controlBarEl.object3D.visible=!0}else"HEAD"===t.controlMode&&(t.leftHandEl.removeEventListener("buttondown",this.leftDownHandler),t.leftHandEl.removeEventListener("buttonup",this.leftUpHandler),t.rightHandEl.removeEventListener("buttondown",this.rightDownHandler),t.rightHandEl.removeEventListener("buttonup",this.rightUpHandler),t.controlBarEl.object3D.visible=!1)},handHandler:function(t,e,o,n){const i=o.leftHandEl.components["tracked-controls"].controller.gamepad;if(i&&i.buttons){o.isAnyPressedLeft=!1;const t=i.buttons;for(let e=0;e<t.length;++e)t[e].pressed&&(o.isAnyPressedLeft=!0)}else"LEFT"===t&&(o.isAnyPressedLeft="DOWN"===e);const r=o.rightHandEl.components["tracked-controls"].controller.gamepad;if(r&&r.buttons){o.isAnyPressedRight=!1;const t=r.buttons;for(let e=0;e<t.length;++e)t[e].pressed&&(o.isAnyPressedRight=!0)}else"RIGHT"===t&&(o.isAnyPressedRight="DOWN"===e);if(o.isAnyPressedLeft&&o.isAnyPressedRight){if("BOTH"!==o.controlSubmode){const t=o.leftHandEl.getAttribute("position"),e=o.rightHandEl.getAttribute("position");o.controlNeutralHeight=(t.y+e.y)/2}o.controlSubmode="BOTH"}else if(o.isAnyPressedLeft){if("LEFT"!==o.controlSubmode){const t=o.leftHandEl.getAttribute("position");o.controlNeutralHeight=t.y}o.controlSubmode="LEFT"}else if(o.isAnyPressedRight){if("RIGHT"!==o.controlSubmode){const t=o.rightHandEl.getAttribute("position");o.controlNeutralHeight=t.y}o.controlSubmode="RIGHT"}else o.controlSubmode="NONE";o.controlNeutralHeight=Math.min(Math.max(o.controlNeutralHeight,.25),1.9)},buttondown:function(t,e){t.isFlying?t.debug&&AFRAME.scenes[0].emit("hover",e):AFRAME.scenes[0].emit("launch",e)},countYellowStars:function(t,e){t.numYellowStars=AFRAME.scenes[0].querySelectorAll(".star").length,console.log("numYellowStars:",t.numYellowStars),t.numYellowStars&&(this.ding=new Howl({src:["../assets/393633__daronoxus__ding.mp3"]}))},launch:function(t,e){console.log("launch",e),t.isFlying=!0,t.controlsReminderDisplayed=!1;let o=AFRAME.scenes[0].querySelector("#prelaunchHelp");o&&o.setAttribute("value",""),Object(n.c)();let i=AFRAME.scenes[0].querySelector("#postlaunchHelp");if(i&&i.src){let t=new Howl({src:[i.src]});setTimeout(()=>{t.play()},6e4)}},hover:function(t,e){console.log("hover",e),t.isFlying=!1},loaded:function(t,e){document.getElementById("intro")||this.startInteraction(t)},"enter-vr":function(t){this.startInteraction(t)},"exit-vr":function(t,e){t.controlsReminderDisplayed&&this.showControlsReminder(t),document.getElementById("intro")&&AFRAME.scenes[0].emit("hover",e)},startInteraction:function(t){t.controlsReminderDisplayed?this.showControlsReminder(t):setTimeout(this.showControlsReminder.bind(this,t),1e4)},showControlsReminder:function(t){let e=AFRAME.scenes[0].querySelector("#prelaunchHelp"),o=document.getElementById("intro");!e||o&&!AFRAME.scenes[0].is("vr-mode")||t.isFlying||(t.controlsReminderDisplayed=!0,AFRAME.scenes[0].is("vr-mode")&&AFRAME.utils.device.checkHeadsetConnected()||AFRAME.utils.device.isMobileVR()?e.setAttribute("value","The wing above you\npoints where you're flying.\n\nTilt left: turn left\nTilt right: turn right\nUp: climb & slow down\nDown: dive & speed up\nTrigger, button or touchpad: launch"):AFRAME.utils.device.isMobile()?e.setAttribute("value","The wing above you\npoints where you're flying.\n\nRoll your device left: turn left\nRoll your device right: turn right\nTilt up: climb & slow down\nTilt down: dive & speed up\nTap screen: launch"):e.setAttribute("value","The wing above you\npoints where you're flying.\n\nA: turn left\nD: turn right\nW: climb (& slow down)\nS: dive (& speed up)\nSpace bar: launch"))},iterate:function(t,e){let o,i;switch(e.timeDelta=Math.min(e.timeDelta,100),t.time+=e.timeDelta*t.difficulty,t.controlMode){case"HEAD":let r=t.cameraEl.getAttribute("rotation");if(!r)return void console.warn("camera rotation not available");o=Object(n.e)()?r.x+20:r.x,i=r.z;break;case"HANDS":const l=t.leftHandEl.getAttribute("position"),a=t.rightHandEl.getAttribute("position");switch(t.controlSubmode){case"BOTH":let{position:e,rotation:r}=Object(n.a)(l,a);t.controlBarEl.setAttribute("position",e),t.controlBarEl.setAttribute("rotation",{x:r.x,y:r.y,z:r.z+90}),o=150*(e.y-t.controlNeutralHeight),i=r.z;break;case"LEFT":const s=t.leftHandEl.getAttribute("rotation");t.controlBarEl.setAttribute("position",l),t.controlBarEl.setAttribute("rotation",s),o=150*(l.y-t.controlNeutralHeight),i=s.z+90;break;case"RIGHT":const c=t.rightHandEl.getAttribute("rotation");t.controlBarEl.setAttribute("position",a),t.controlBarEl.setAttribute("rotation",c),o=150*(a.y-t.controlNeutralHeight),i=c.z-90;break;case"NONE":t.controlBarEl.setAttribute("position",{x:0,y:t.controlNeutralHeight,z:-.4}),t.controlBarEl.setAttribute("rotation",{x:0,y:0,z:90}),o=0,i=0}}let r=o-t.gliderRotationX,l=(r+15*Math.sign(r))*(e.timeDelta/1e3);Math.abs(l)>Math.abs(r)&&(l=r);let a=t.gliderRotationX+l;a=Math.max(a,-75),a=Math.min(a,75),t.gliderRotationX=a;let s=i-t.gliderRotationZ,c=(s+15*Math.sign(s))*(e.timeDelta/1e3);Math.abs(c)>Math.abs(s)&&(c=s);let d=t.gliderRotationZ+c;d=Math.max(d,-70),d=Math.min(d,70),t.gliderRotationZ=d;let u=t.gliderRotationZ*e.timeDelta/1e3;if(t.gliderRotationY=(t.gliderRotationY+u+180)%360-180,t.isFlying){let o=t.gliderSpeed*e.timeDelta/1e3,i=Object(n.b)(t.gliderRotationX,t.gliderRotationY+90,o),r=i.y;t.gliderPosition.x+=i.x,t.gliderPosition.y+=r,t.gliderPosition.z+=i.z;let l=(-Math.sign(r)*Math.sqrt(19.614*Math.abs(r))-5e-4*t.gliderSpeed*t.gliderSpeed)*e.timeDelta/1e3;t.gliderSpeed=Math.max(t.gliderSpeed+l,.1),t.gliderSpeed=Math.min(t.gliderSpeed,99.4),t.gliderSpeed<9.95?t.hudText=t.gliderSpeed.toFixed(1):t.hudText=t.gliderSpeed.toFixed(0),t.gliderEl.setAttribute("raycaster","far",t.gliderSpeed/4)}},placeInGliderPath:function(t,e){let o=t.gliderRotationX+(Math.random()-.5)*e.variation,i=t.gliderRotationY+90+(Math.random()-.5)*e.variation,r=Object(n.b)(o,i,e.distance),l={x:t.gliderPosition.x+r.x,y:t.gliderPosition.y+r.y,z:t.gliderPosition.z+r.z};e.el.setAttribute("position",l),e.el.setAttribute("rotation","y",t.gliderRotationY)},adjustForMagicWindow:function(t){Object(n.e)()?(t.object3D.rotation.x=THREE.Math.degToRad(-30),t.object3D.scale.set(1,1,3)):(t.object3D.rotation.x=0,t.object3D.scale.set(1,1,1))},adjustHudForVR:function(t){AFRAME.utils.device.isMobile()?(t.object3D.position.x=.2,t.object3D.position.y=.3):(t.object3D.position.x=.2,t.object3D.position.y=.42),t.object3D.rotation.x=THREE.Math.degToRad(30),t.object3D.rotation.y=THREE.Math.degToRad(-20)},adjustHudForFlat:function(t){Object(n.d)()?(t.object3D.position.x=.85,t.object3D.position.y=.5,t.object3D.rotation.x=0,t.object3D.rotation.y=0):(t.object3D.position.x=.7,t.object3D.position.y=.2,t.object3D.rotation.x=THREE.Math.degToRad(30),t.object3D.rotation.y=THREE.Math.degToRad(-20))}},computeState:function(t,e){try{let e=t.questComplete;if(t.questComplete=t.numYellowStars<=0||t.stars/t.numYellowStars>=.95,t.questComplete&&!e){new Howl({src:["../assets/361684__taranp__horncall-strauss1-eflatmajor_incipit.mp3"]}).play()}}catch(t){console.error(t)}}}),AFRAME.registerComponent("armature-tick-state",{init:function(){AFRAME.scenes[0].emit("setArmatureEl",this.el)},tick:function(t,e){AFRAME.scenes[0].emit("iterate",{time:t,timeDelta:e})}})},19:function(t,e,o){"use strict";o.r(e);var n=o(0);o(1);AFRAME.registerComponent("ginnungagap",{init:function(){let t=this.el;if(Object(n.g)("100495__jakobthiesen__light-rain-in-forest.ogg",1),Object(n.d)()){let e=document.createElement("a-entity");e.setAttribute("particle-system",{preset:"rain",particleCount:500}),e.setAttribute("bind__position","gliderPosition"),t.appendChild(e)}this.clouds=[];let e=this.clouds;function o(o=500,n=80){e.length>=100&&t.components.pool__clouds.returnEntity(e.shift());let i=t.components.pool__clouds.requestEntity(!0),r=0;i.setAttribute("material","opacity",r);let l=setInterval(()=>{r+=.1/120,i.setAttribute("material","opacity",r),r>=.5&&clearInterval(l)},16);AFRAME.scenes[0].emit("placeInGliderPath",{el:i,distance:o,variation:n}),i.object3D.rotation.z=2*Math.random()*Math.PI,e.push(i)}setTimeout(()=>{for(let t=0;t<=80;++t)o(875-10*t,270)},4),setInterval(o,5e3),this.armaturePosition=document.getElementById("armature").object3D.position;var i=sessionStorage.getItem("returnWorld");if(i){var r=document.getElementById("returnPortal");r.setAttribute("link","href",i),r.setAttribute("link","image",i+"screenshot.png")}setInterval(()=>{let t=document.getElementById("returnPortal");t.setAttribute("visible","true"),AFRAME.scenes[0].emit("placeInGliderPath",{el:t,distance:100,variation:45})},6e4)},play:function(){this.el.emit("launch","ginnungagap play")},tick:function(){this.clouds.forEach(t=>{if(this.armaturePosition.distanceTo(t.object3D.position)>100){let e=t.object3D.rotation.z;t.object3D.lookAt(this.armaturePosition),t.object3D.rotation.z=e}})}})},2:function(t,e){
/*!
 * Copyright 2015 Google Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
window.requestIdleCallback=window.requestIdleCallback||function(t){return setTimeout(function(){var e=Date.now();t({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(t){clearTimeout(t)}}});
//# sourceMappingURL=ginnungagap.js.map