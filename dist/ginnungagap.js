!function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=19)}({0:function(e,t,i){"use strict";function o(){if(!a())return;let e,t=document.querySelector("canvas.a-canvas"),i=t.requestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen;i&&(e=i.apply(t)),e&&e.then||(e=Promise.resolve()),e.then(n,n)}function n(){screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape").then(e=>{console.log("screen orientation locked:",e)}).catch(e=>{console.warn("screen orientation didn't lock:",e)})}function r(){return!(AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR())}function a(){return AFRAME.utils.device.isMobile()&&!AFRAME.scenes[0].is("vr-mode")}function l(e,t,i){let o=e/180*Math.PI,n=i*Math.sin(o),r=i*Math.cos(o),a=t/180*Math.PI;return{x:r*Math.cos(a),y:n,z:-r*Math.sin(a)}}i.d(t,"b",function(){return o}),i.d(t,"c",function(){return r}),i.d(t,"d",function(){return a}),i.d(t,"a",function(){return l}),i.d(t,"e",function(){return c});var s=null;function c(e,t){s=new Howl({src:e,autoplay:!0,loop:!0,volume:t||1,html5:!1,onplayerror:function(){s.once("unlock",function(){s.play()})}})}document.addEventListener("visibilitychange",()=>{s&&(document.hidden?s.pause():s.play())},!1)},1:function(e,t,i){"use strict";i(2);var o=i(0);AFRAME.registerState({initialState:{armatureEl:null,gliderEl:null,cameraEl:null,time:0,difficulty:.6,gliderPosition:{x:-30,y:15,z:30},gliderPositionStart:{x:-30,y:15,z:30},gliderRotationX:0,gliderRotationY:-45,gliderRotationZ:0,gliderRotationYStart:-45,isFlying:!1,gliderSpeed:5,numYellowStars:Math.POSITIVE_INFINITY,stars:0,questComplete:!1,inventory:{},hudVisible:!0,hudText:"",controlsReminderDisplayed:!1,debug:!1},handlers:{setState:function(e,t){for(let i in t)"target"!==i&&(console.log("setting",i,t[i]),e[i]=t[i])},setArmatureEl:function(e,t){this.powerup=new Howl({src:["../assets/411460__inspectorj__power-up-bright-a.mp3"]}),console.log("hasNativeWebVRImplementation:",window.hasNativeWebVRImplementation),console.log("isMobile:",AFRAME.utils.device.isMobile()),console.log("isMobileVR:",AFRAME.utils.device.isMobileVR()),e.armatureEl=t,e.gliderEl=t.querySelector("#glider"),e.cameraEl=t.querySelector("[camera]");let i=AFRAME.scenes[0].querySelector("a-dust");i&&requestIdleCallback(()=>{i.components.dust.setCamera(e.armatureEl)});let n=e.armatureEl.querySelector("#body"),r=e.gliderEl.querySelector("#wing"),a=t.querySelector("#hud");this.adjustForMagicWindow(r),AFRAME.scenes[0].is("vr-mode")&&AFRAME.utils.device.checkHeadsetConnected()?(this.adjustHudForVR(a),e.difficulty=.75):(this.adjustHudForFlat(a),Object(o.d)()?e.difficulty=.6:e.difficulty=.5),AFRAME.scenes[0].addEventListener("enter-vr",t=>{AFRAME.utils.device.checkHeadsetConnected()&&(n.object3D.position.y=-1.6,this.adjustHudForVR(a),this.adjustForMagicWindow(r),e.difficulty=.75)}),AFRAME.scenes[0].addEventListener("exit-vr",t=>{this.adjustHudForFlat(a),this.adjustForMagicWindow(r),Object(o.d)()?e.difficulty=.6:e.difficulty=.5}),Object(o.c)()&&!AFRAME.utils.device.checkHeadsetConnected()&&(console.log("desktop w/o headset; disabling look-controls-z so keyboard controls can function"),e.cameraEl.setAttribute("look-controls-z","enabled","false")),e.gliderEl.addEventListener("raycaster-intersection",t=>{if(t.detail.intersections.length>0&&t.detail.intersections[0].distance>0){console.log("CRASH!",t.detail.els[0].tagName,t.detail.intersections[0].distance,e.gliderEl.getAttribute("raycaster").far,e.gliderSpeed/4),AFRAME.scenes[0].emit("hover",{}),new Howl({src:["../assets/198876__bone666138__crash.mp3"]}).play(),setTimeout(()=>{e.gliderSpeed>=30?(sessionStorage.setItem("returnWorld",location.pathname),location.pathname="/ginnungagap/"):(e.gliderPosition.x=e.gliderPositionStart.x,e.gliderPosition.y=e.gliderPositionStart.y,e.gliderPosition.z=e.gliderPositionStart.z,e.gliderRotationX=0,e.gliderRotationY=e.gliderRotationYStart,e.gliderSpeed=5,e.hudText="",e.cameraEl.object3D.rotation.x=0,e.cameraEl.object3D.rotation.y=0,e.cameraEl.object3D.rotation.z=0,setTimeout(this.showControlsReminder.bind(this,e),3e3))},2e3)}}),t.addEventListener("hitstart",t=>{t.detail.intersectedEls.forEach(t=>{if(t.classList.contains("powerup"))console.log("powerup"),e.gliderSpeed+=16,this.powerup.play();else if(t.classList.contains("star"))++e.stars,console.log("collected star",e.stars,"of",e.numYellowStars),t.parentNode.removeChild(t),this.ding.play();else if(t.classList.contains("proximitySound")){let e=t.getAttribute("data-sound-url"),i=t.getAttribute("data-sound-volume")||1;e&&new Howl({src:e,volume:i,autoplay:!0});let o=t.getAttribute("data-text"),n=AFRAME.scenes[0].querySelector("#subtitle");o&&n&&(n.setAttribute("value",o),setTimeout(()=>{n.setAttribute("value","")},5e3))}else t.components.link&&(console.log("hit link"),"/ginnungagap/"!==location.pathname&&sessionStorage.setItem("previousWorld",location.pathname))})}),document.addEventListener("keydown",function(t){e.cameraEl.getAttribute("rotation");switch(t.code){case"KeyA":case"ArrowLeft":e.cameraEl.object3D.rotation.z+=.07;break;case"KeyD":case"ArrowRight":e.cameraEl.object3D.rotation.z-=.07;break;case"KeyW":case"ArrowUp":e.cameraEl.object3D.rotation.x+=.045;break;case"KeyS":case"ArrowDown":e.cameraEl.object3D.rotation.x-=.045;break;case"Space":e.isFlying?e.debug&&AFRAME.scenes[0].emit("hover",t):AFRAME.scenes[0].emit("launch",t);break;case"Enter":e.hudVisible=!e.hudVisible}},!1)},buttondown:function(e,t){e.isFlying?e.debug&&AFRAME.scenes[0].emit("hover",t):AFRAME.scenes[0].emit("launch",t)},countYellowStars:function(e,t){e.numYellowStars=AFRAME.scenes[0].querySelectorAll(".star").length,console.log("numYellowStars:",e.numYellowStars),e.numYellowStars&&(this.ding=new Howl({src:["../assets/393633__daronoxus__ding.mp3"]}))},launch:function(e,t){console.log("launch",t),e.isFlying=!0,e.controlsReminderDisplayed=!1;let i=AFRAME.scenes[0].querySelector("#prelaunchHelp");i&&i.setAttribute("value",""),Object(o.b)()},hover:function(e,t){console.log("hover",t),e.isFlying=!1},loaded:function(e,t){document.getElementById("intro")||this.startInteraction(e)},"enter-vr":function(e){this.startInteraction(e)},"exit-vr":function(e,t){e.controlsReminderDisplayed&&this.showControlsReminder(e),document.getElementById("intro")&&AFRAME.scenes[0].emit("hover",t)},startInteraction:function(e){e.controlsReminderDisplayed?this.showControlsReminder(e):setTimeout(this.showControlsReminder.bind(this,e),6e3)},showControlsReminder:function(e){let t=AFRAME.scenes[0].querySelector("#prelaunchHelp"),i=document.getElementById("intro");!t||i&&!AFRAME.scenes[0].is("vr-mode")||e.isFlying||(e.controlsReminderDisplayed=!0,AFRAME.scenes[0].is("vr-mode")&&AFRAME.utils.device.checkHeadsetConnected()||AFRAME.utils.device.isMobileVR()?t.setAttribute("value","The wing above you\npoints where you're flying.\n\nTilt your head left: turn left\nTilt your head right: turn right\nTrigger or touchpad: launch"):AFRAME.utils.device.isMobile()?t.setAttribute("value","The wing above you\npoints where you're flying.\n\nRoll your device left: turn left\nRoll your device right: turn right\nTap screen: launch"):t.setAttribute("value","The wing above you\npoints where you're flying.\n\nA: turn left\nD: turn right\nW: climb (& slow down)\nS: descend (& speed up)\nSpace bar: launch"))},iterate:function(e,t){t.timeDelta=Math.min(t.timeDelta,100),e.time+=t.timeDelta*e.difficulty;let i=e.cameraEl.getAttribute("rotation");if(!i)return void console.warn("camera rotation not available");let n=(Object(o.d)()?i.x+20:i.x)-e.gliderRotationX,r=(n+15*Math.sign(n))*(t.timeDelta/1e3);Math.abs(r)>Math.abs(n)&&(r=n);let a=e.gliderRotationX+r;a=Math.max(a,-89),a=Math.min(a,89),e.gliderRotationX=a;let l=i.z-e.gliderRotationZ,s=(l+15*Math.sign(l))*(t.timeDelta/1e3);Math.abs(s)>Math.abs(l)&&(s=l);let c=e.gliderRotationZ+s;c=Math.max(c,-89),c=Math.min(c,89),e.gliderRotationZ=c;let u=e.gliderRotationZ*t.timeDelta/1e3;if(e.gliderRotationY=(e.gliderRotationY+u+180)%360-180,e.isFlying){let i=e.gliderSpeed*t.timeDelta/1e3,n=Object(o.a)(e.gliderRotationX,e.gliderRotationY+90,i),r=n.y;e.gliderPosition.x+=n.x,e.gliderPosition.y+=r,e.gliderPosition.z+=n.z;let a=(-Math.sign(r)*Math.sqrt(19.614*Math.abs(r))-5e-4*e.gliderSpeed*e.gliderSpeed)*t.timeDelta/1e3;e.gliderSpeed=Math.max(e.gliderSpeed+a,.1),e.gliderSpeed=Math.min(e.gliderSpeed,99.4),e.gliderSpeed<9.95?e.hudText=e.gliderSpeed.toFixed(1):e.hudText=e.gliderSpeed.toFixed(0),e.gliderEl.setAttribute("raycaster","far",e.gliderSpeed/4)}},placeInGliderPath:function(e,t){let i=e.gliderRotationX+(Math.random()-.5)*t.variation,n=e.gliderRotationY+90+(Math.random()-.5)*t.variation,r=Object(o.a)(i,n,t.distance),a={x:e.gliderPosition.x+r.x,y:e.gliderPosition.y+r.y,z:e.gliderPosition.z+r.z};t.el.setAttribute("position",a),t.el.setAttribute("rotation","y",e.gliderRotationY)},adjustForMagicWindow:function(e){Object(o.d)()?(e.object3D.rotation.x=THREE.Math.degToRad(-30),e.object3D.scale.set(1,1,3)):(e.object3D.rotation.x=0,e.object3D.scale.set(1,1,1))},adjustHudForVR:function(e){AFRAME.utils.device.isMobile()?(e.object3D.position.x=.2,e.object3D.position.y=.3):(e.object3D.position.x=.2,e.object3D.position.y=.42),e.object3D.rotation.x=THREE.Math.degToRad(30),e.object3D.rotation.y=THREE.Math.degToRad(-20)},adjustHudForFlat:function(e){Object(o.c)()?(e.object3D.position.x=.85,e.object3D.position.y=.5,e.object3D.rotation.x=0,e.object3D.rotation.y=0):(e.object3D.position.x=.7,e.object3D.position.y=.2,e.object3D.rotation.x=THREE.Math.degToRad(30),e.object3D.rotation.y=THREE.Math.degToRad(-20))}},computeState:function(e,t){try{let t=e.questComplete;if(e.questComplete=e.stars>=e.numYellowStars,e.questComplete&&!t){new Howl({src:["../assets/361684__taranp__horncall-strauss1-eflatmajor_incipit.mp3"]}).play()}}catch(e){console.error(e)}}}),AFRAME.registerComponent("armature-tick-state",{init:function(){AFRAME.scenes[0].emit("setArmatureEl",this.el)},tick:function(e,t){AFRAME.scenes[0].emit("iterate",{time:e,timeDelta:t})}})},19:function(e,t,i){"use strict";i.r(t);var o=i(0);i(1);AFRAME.registerComponent("ginnungagap",{init:function(){let e=this.el;if(Object(o.e)("100495__jakobthiesen__light-rain-in-forest.ogg",1),Object(o.c)()){let t=document.createElement("a-entity");t.setAttribute("particle-system",{preset:"rain",particleCount:500}),t.setAttribute("bind__position","gliderPosition"),e.appendChild(t)}this.clouds=[];let t=this.clouds;function i(i=500,o=80){t.length>=100&&e.components.pool__clouds.returnEntity(t.shift());let n=e.components.pool__clouds.requestEntity(!0),r=0;n.setAttribute("material","opacity",r);let a=setInterval(()=>{r+=.1/120,n.setAttribute("material","opacity",r),r>=.5&&clearInterval(a)},16);AFRAME.scenes[0].emit("placeInGliderPath",{el:n,distance:i,variation:o}),n.object3D.rotation.z=2*Math.random()*Math.PI,t.push(n)}setTimeout(()=>{for(let e=0;e<=80;++e)i(875-10*e,270)},4),setInterval(i,5e3),this.armaturePosition=document.getElementById("armature").object3D.position;var n=sessionStorage.getItem("returnWorld");if(n){var r=document.getElementById("returnPortal");r.setAttribute("link","href",n),r.setAttribute("link","image",n+"screenshot.png")}setInterval(()=>{let e=document.getElementById("returnPortal");e.setAttribute("visible","true"),AFRAME.scenes[0].emit("placeInGliderPath",{el:e,distance:100,variation:45})},6e4)},play:function(){this.el.emit("launch","ginnungagap play")},tick:function(){this.clouds.forEach(e=>{if(this.armaturePosition.distanceTo(e.object3D.position)>100){let t=e.object3D.rotation.z;e.object3D.lookAt(this.armaturePosition),e.object3D.rotation.z=t}})}})},2:function(e,t){
/*!
 * Copyright 2015 Google Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
window.requestIdleCallback=window.requestIdleCallback||function(e){return setTimeout(function(){var t=Date.now();e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(e){clearTimeout(e)}}});
//# sourceMappingURL=ginnungagap.js.map