!function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=19)}({0:function(t,e,o){"use strict";function n(){if(!l())return;let t,e=document.querySelector("canvas.a-canvas"),o=e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen;o&&(t=o.apply(e)),t&&t.then||(t=Promise.resolve()),t.then(i,i)}function i(){screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape").then(t=>{console.log("screen orientation locked:",t)}).catch(t=>{console.warn("screen orientation didn't lock:",t)})}function r(){return!(AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR())}function l(){return AFRAME.utils.device.isMobile()&&!AFRAME.scenes[0].is("vr-mode")}function s(t,e,o){let n=t/180*Math.PI,i=o*Math.sin(n),r=o*Math.cos(n),l=e/180*Math.PI;return{x:r*Math.cos(l),y:i,z:-r*Math.sin(l)}}o.d(e,"b",function(){return n}),o.d(e,"c",function(){return r}),o.d(e,"d",function(){return l}),o.d(e,"a",function(){return s}),o.d(e,"f",function(){return c}),o.d(e,"e",function(){return d});var a=null;function c(t,e){a=new Howl({src:t,autoplay:!0,loop:!0,volume:e||1,html5:!1,onplayerror:function(){a.once("unlock",function(){a.play()})}})}function d(){a&&!a.playing()&&a.play()}if(document.addEventListener("visibilitychange",()=>{a&&(document.hidden?a.pause():a.play())},!1),document.monetization){document.monetization.addEventListener("monetizationstart",function(t){console.log("monetization started:",t)}),document.monetization.addEventListener("monetizationstop",function(t){console.log("monetization stopped:",t)})}else console.log("no monetization API")},1:function(t,e,o){"use strict";o(2);var n=o(0);AFRAME.registerState({initialState:{armatureEl:null,gliderEl:null,cameraEl:null,leftHandEl:null,rightHandEl:null,controllerConnections:{},isAnyPressedLeft:!1,isAnyPressedRight:!1,xSetting:0,zSetting:0,controlStickEl:null,controlNeutralHeight:.95,controlMode:"HEAD",controlSubmode:"NONE",time:0,difficulty:.6,gliderPosition:{x:-30,y:15,z:30},gliderPositionStart:{x:-30,y:15,z:30},gliderRotationX:0,gliderRotationY:-45,gliderRotationZ:0,gliderRotationYStart:-45,isFlying:!1,gliderSpeed:5,numYellowStars:Math.POSITIVE_INFINITY,stars:0,questComplete:!1,inventory:{},hudVisible:!0,hudText:"",controlsReminderDisplayed:!1,debug:!1},handlers:{setState:function(t,e){for(let o in e)"target"!==o&&(console.log("setting",o,e[o]),t[o]=e[o])},setArmatureEl:function(t,e){this.powerup=new Howl({src:["../assets/411460__inspectorj__power-up-bright-a.mp3"]}),console.log("hasNativeWebXRImplementation:",window.hasNativeWebXRImplementation),console.log("hasNativeWebVRImplementation:",window.hasNativeWebVRImplementation),console.log("isMobile:",AFRAME.utils.device.isMobile()),console.log("isMobileVR:",AFRAME.utils.device.isMobileVR()),t.armatureEl=e,t.gliderEl=e.querySelector("#glider"),t.cameraEl=e.querySelector("[camera]");let o=AFRAME.scenes[0].querySelector("a-dust");o&&requestIdleCallback(()=>{o.components.dust.setCamera(t.armatureEl)});let i=t.armatureEl.querySelector("#body"),r=t.gliderEl.querySelector("#wing"),l=e.querySelector("#hud");this.adjustForMagicWindow(r),AFRAME.scenes[0].is("vr-mode")&&AFRAME.utils.device.checkHeadsetConnected()?(this.adjustHudForVR(l),t.difficulty=.75):(this.adjustHudForFlat(l),Object(n.d)()?t.difficulty=.6:t.difficulty=.5),AFRAME.scenes[0].addEventListener("enter-vr",e=>{AFRAME.utils.device.checkHeadsetConnected()&&(i.object3D.position.y=-1.6,this.adjustHudForVR(l),this.adjustForMagicWindow(r),t.difficulty=.75),Object(n.e)()}),AFRAME.scenes[0].addEventListener("exit-vr",e=>{this.adjustHudForFlat(l),this.adjustForMagicWindow(r),Object(n.d)()?t.difficulty=.6:t.difficulty=.5}),Object(n.c)()&&!AFRAME.utils.device.checkHeadsetConnected()&&(console.log("desktop w/o headset; disabling look-controls so keyboard controls can function"),t.cameraEl.setAttribute("look-controls","enabled","false")),t.gliderEl.addEventListener("raycaster-intersection",e=>{if(e.detail.intersections.length>0&&e.detail.intersections[0].distance>0){console.log("CRASH!",e.detail.els[0].tagName,e.detail.intersections[0].distance,t.gliderEl.getAttribute("raycaster").far,t.gliderSpeed/4),AFRAME.scenes[0].emit("hover",{}),new Howl({src:["../assets/198876__bone666138__crash.mp3"]}).play(),setTimeout(()=>{t.gliderSpeed>=30?(sessionStorage.setItem("returnWorld",location.pathname),location.pathname="/ginnungagap/"):(t.gliderPosition.x=t.gliderPositionStart.x,t.gliderPosition.y=t.gliderPositionStart.y,t.gliderPosition.z=t.gliderPositionStart.z,t.gliderRotationX=0,t.gliderRotationY=t.gliderRotationYStart,t.gliderSpeed=5,this.controlStickToNeutral(t),t.hudText="",t.cameraEl.object3D.rotation.x=0,t.cameraEl.object3D.rotation.y=0,t.cameraEl.object3D.rotation.z=0,setTimeout(this.showControlsReminder.bind(this,t),3e3))},2e3)}}),e.addEventListener("hitstart",e=>{e.detail.intersectedEls.forEach(e=>{if(e.classList.contains("powerup"))console.log("powerup"),t.gliderSpeed+=16,this.powerup.play();else if(e.classList.contains("star"))++t.stars,console.log("collected star",t.stars,"of",t.numYellowStars),e.parentNode.removeChild(e),this.ding.play();else if(e.classList.contains("proximitySound")){let t=e.getAttribute("data-sound-url"),o=e.getAttribute("data-sound-volume")||1;t&&new Howl({src:t,volume:o,autoplay:!0});let n=e.getAttribute("data-text"),i=AFRAME.scenes[0].querySelector("#subtitle");n&&i&&(i.setAttribute("value",n),setTimeout(()=>{i.setAttribute("value","")},5e3))}else e.components.link&&(console.log("hit link"),"/ginnungagap/"!==location.pathname&&sessionStorage.setItem("previousWorld",location.pathname))})}),document.addEventListener("keydown",function(e){t.cameraEl.getAttribute("rotation");switch(e.code){case"KeyA":case"ArrowLeft":t.cameraEl.object3D.rotation.z+=.07;break;case"KeyD":case"ArrowRight":t.cameraEl.object3D.rotation.z-=.07;break;case"KeyW":case"ArrowUp":t.cameraEl.object3D.rotation.x+=.045;break;case"KeyS":case"ArrowDown":t.cameraEl.object3D.rotation.x-=.045;break;case"Space":t.isFlying?t.debug&&AFRAME.scenes[0].emit("hover",e):AFRAME.scenes[0].emit("launch",e);break;case"Enter":t.hudVisible=!t.hudVisible}},!1),t.leftHandEl=document.getElementById("leftHand"),t.rightHandEl=document.getElementById("rightHand"),Object(n.c)()&&(t.leftHandEl.setAttribute("hand-controls","handModelStyle","highPoly"),t.rightHandEl.setAttribute("hand-controls","handModelStyle","highPoly")),this.leftDownHandler=this.handHandler.bind(this,"LEFT","DOWN",t),this.leftUpHandler=this.handHandler.bind(this,"LEFT","UP",t),this.rightDownHandler=this.handHandler.bind(this,"RIGHT","DOWN",t),this.rightUpHandler=this.handHandler.bind(this,"RIGHT","UP",t),t.controlStickEl=document.getElementById("controlStick")},controllerconnected:function(t,e){t.controllerConnections[e.component.el.id]=!0,this.adjustControlMode(t)},controllerdisconnected:function(t,e){t.controllerConnections[e.component.el.id]=!1,this.adjustControlMode(t)},adjustControlMode:function(t){const e=t.controlMode;t.controllerConnections.leftHand||t.controllerConnections.rightHand?t.controlMode="HANDS":t.controlMode="HEAD",t.controlMode!==e&&(console.log("changed control mode from",e,"to",t.controlMode),"HANDS"===t.controlMode?(t.leftHandEl.addEventListener("buttondown",this.leftDownHandler),t.leftHandEl.addEventListener("buttonup",this.leftUpHandler),t.rightHandEl.addEventListener("buttondown",this.rightDownHandler),t.rightHandEl.addEventListener("buttonup",this.rightUpHandler),this.controlStickToNeutral(t),t.controlStickEl.object3D.visible=!0):"HEAD"===t.controlMode&&(t.leftHandEl.removeEventListener("buttondown",this.leftDownHandler),t.leftHandEl.removeEventListener("buttonup",this.leftUpHandler),t.rightHandEl.removeEventListener("buttondown",this.rightDownHandler),t.rightHandEl.removeEventListener("buttonup",this.rightUpHandler),t.controlStickEl.object3D.visible=!1))},handHandler:function(t,e,o,n){const i=o.isAnyPressedLeft,r=o.leftHandEl.components["tracked-controls"],l=r&&r.controller&&r.controller.gamepad&&r.controller.gamepad.buttons;if(l){o.isAnyPressedLeft=!1;for(let t=0;t<l.length;++t)l[t].pressed&&(o.isAnyPressedLeft=!0)}else"LEFT"===t&&(o.isAnyPressedLeft="DOWN"===e);const s=o.isAnyPressedRight,a=o.rightHandEl.components["tracked-controls"],c=a&&a.controller&&a.controller.gamepad&&a.controller.gamepad.buttons;if(c){o.isAnyPressedRight=!1;for(let t=0;t<c.length;++t)c[t].pressed&&(o.isAnyPressedRight=!0)}else"RIGHT"===t&&(o.isAnyPressedRight="DOWN"===e);if(o.isAnyPressedLeft&&!i)switch(o.controlSubmode){case"LEFT":o.controlSubmode="NONE";break;case"RIGHT":case"NONE":o.controlSubmode="LEFT"}else if(o.isAnyPressedRight&&!s)switch(o.controlSubmode){case"RIGHT":o.controlSubmode="NONE";break;case"LEFT":case"NONE":o.controlSubmode="RIGHT"}console.log("controlSubmode:",o.controlSubmode)},controlStickToNeutral:function(t){if(t.controlStickEl){const e=t.cameraEl.getAttribute("position");t.controlNeutralHeight=e.y-.56,t.controlStickEl.setAttribute("position",{x:0,y:t.controlNeutralHeight,z:-.4}),t.controlStickEl.setAttribute("rotation",{x:0,y:0,z:0}),t.xSetting=0,t.zSetting=0}},buttondown:function(t,e){t.isFlying?t.debug&&AFRAME.scenes[0].emit("hover",e):AFRAME.scenes[0].emit("launch",e)},countYellowStars:function(t,e){t.numYellowStars=AFRAME.scenes[0].querySelectorAll(".star").length,console.log("numYellowStars:",t.numYellowStars),t.numYellowStars&&(this.ding=new Howl({src:["../assets/393633__daronoxus__ding.mp3"]}))},launch:function(t,e){console.log("launch",e),t.isFlying=!0,t.controlsReminderDisplayed=!1;let o=AFRAME.scenes[0].querySelector("#prelaunchHelp");o&&o.setAttribute("value",""),Object(n.b)();let i=AFRAME.scenes[0].querySelector("#postlaunchHelp");if(i&&i.src){let t=new Howl({src:[i.src]});setTimeout(()=>{t.play()},6e4)}},hover:function(t,e){console.log("hover",e),t.isFlying=!1},loaded:function(t,e){document.getElementById("intro")||this.startInteraction(t)},"enter-vr":function(t){this.startInteraction(t)},"exit-vr":function(t,e){t.controlsReminderDisplayed&&this.showControlsReminder(t),document.getElementById("intro")&&AFRAME.scenes[0].emit("hover",e)},startInteraction:function(t){t.controlsReminderDisplayed?this.showControlsReminder(t):setTimeout(this.showControlsReminder.bind(this,t),1e4)},showControlsReminder:function(t){let e=AFRAME.scenes[0].querySelector("#prelaunchHelp"),o=document.getElementById("intro");!e||o&&!AFRAME.scenes[0].is("vr-mode")||t.isFlying||(t.controlsReminderDisplayed=!0,AFRAME.scenes[0].is("vr-mode")&&AFRAME.utils.device.checkHeadsetConnected()||AFRAME.utils.device.isMobileVR()?e.setAttribute("value","The wing above you\npoints where you're flying.\n\nTilt left: turn left\nTilt right: turn right\nTilt back: climb & slow down\nTilt forward: dive & speed up\nTrigger, button or touchpad: launch"):AFRAME.utils.device.isMobile()?e.setAttribute("value","The wing above you\npoints where you're flying.\n\nRoll your device left: turn left\nRoll your device right: turn right\nTilt up: climb & slow down\nTilt down: dive & speed up\nTap screen: launch"):e.setAttribute("value","The wing above you\npoints where you're flying.\n\nA: turn left\nD: turn right\nW: climb (& slow down)\nS: dive (& speed up)\nSpace bar: launch"))},iterate:function(t,e){switch(e.timeDelta=Math.min(e.timeDelta,100),t.time+=e.timeDelta*t.difficulty,t.controlMode){case"HEAD":let o=t.cameraEl.getAttribute("rotation");if(!o)return void console.warn("camera rotation not available");let i=Object(n.d)()?o.x+20:o.x;t.xSetting=i,t.zSetting=o.z;break;case"HANDS":const r=t.leftHandEl.getAttribute("position"),l=t.rightHandEl.getAttribute("position");switch(t.controlSubmode){case"LEFT":const e=t.leftHandEl.getAttribute("rotation");t.controlStickEl.setAttribute("position",r),t.controlStickEl.setAttribute("rotation",e),t.xSetting=e.x,t.zSetting=e.z;break;case"RIGHT":const o=t.rightHandEl.getAttribute("rotation");t.controlStickEl.setAttribute("position",l),t.controlStickEl.setAttribute("rotation",o),t.xSetting=o.x,t.zSetting=o.z}}let o=t.xSetting-t.gliderRotationX,i=(o+15*Math.sign(o))*(e.timeDelta/1e3);Math.abs(i)>Math.abs(o)&&(i=o);let r=t.gliderRotationX+i;r=Math.max(r,-75),r=Math.min(r,75),t.gliderRotationX=r;let l=t.zSetting-t.gliderRotationZ,s=(l+15*Math.sign(l))*(e.timeDelta/1e3);Math.abs(s)>Math.abs(l)&&(s=l);let a=t.gliderRotationZ+s;a=Math.max(a,-70),a=Math.min(a,70),t.gliderRotationZ=a;let c=t.gliderRotationZ*e.timeDelta/1e3;if(t.gliderRotationY=(t.gliderRotationY+c+180)%360-180,t.isFlying){let o=t.gliderSpeed*e.timeDelta/1e3,i=Object(n.a)(t.gliderRotationX,t.gliderRotationY+90,o),r=i.y;t.gliderPosition.x+=i.x,t.gliderPosition.y+=r,t.gliderPosition.z+=i.z;let l=(-Math.sign(r)*Math.sqrt(19.614*Math.abs(r))-5e-4*t.gliderSpeed*t.gliderSpeed)*e.timeDelta/1e3;t.gliderSpeed=Math.max(t.gliderSpeed+l,.1),t.gliderSpeed=Math.min(t.gliderSpeed,99.4),t.gliderSpeed<9.95?t.hudText=t.gliderSpeed.toFixed(1):t.hudText=t.gliderSpeed.toFixed(0),t.gliderEl.setAttribute("raycaster","far",t.gliderSpeed/4)}},placeInGliderPath:function(t,e){let o=t.gliderRotationX+(Math.random()-.5)*e.variation,i=t.gliderRotationY+90+(Math.random()-.5)*e.variation,r=Object(n.a)(o,i,e.distance),l={x:t.gliderPosition.x+r.x,y:t.gliderPosition.y+r.y,z:t.gliderPosition.z+r.z};e.el.setAttribute("position",l),e.el.setAttribute("rotation","y",t.gliderRotationY)},adjustForMagicWindow:function(t){Object(n.d)()?(t.object3D.rotation.x=THREE.Math.degToRad(-30),t.object3D.scale.set(1,1,3)):(t.object3D.rotation.x=0,t.object3D.scale.set(1,1,1))},adjustHudForVR:function(t){AFRAME.utils.device.isMobile()?(t.object3D.position.x=.2,t.object3D.position.y=.3):(t.object3D.position.x=.2,t.object3D.position.y=.42),t.object3D.rotation.x=THREE.Math.degToRad(30),t.object3D.rotation.y=THREE.Math.degToRad(-20)},adjustHudForFlat:function(t){Object(n.c)()?(t.object3D.position.x=.85,t.object3D.position.y=.5,t.object3D.rotation.x=0,t.object3D.rotation.y=0):(t.object3D.position.x=.7,t.object3D.position.y=.2,t.object3D.rotation.x=THREE.Math.degToRad(30),t.object3D.rotation.y=THREE.Math.degToRad(-20))}},computeState:function(t,e){try{let e=t.questComplete;if(t.questComplete=t.numYellowStars<=0||t.stars/t.numYellowStars>=.95,t.questComplete&&!e){new Howl({src:["../assets/361684__taranp__horncall-strauss1-eflatmajor_incipit.mp3"]}).play()}}catch(t){console.error(t)}}}),AFRAME.registerComponent("armature-tick-state",{init:function(){AFRAME.scenes[0].emit("setArmatureEl",this.el)},tick:function(t,e){AFRAME.scenes[0].emit("iterate",{time:t,timeDelta:e})}})},19:function(t,e,o){"use strict";o.r(e);var n=o(0);o(1);AFRAME.registerComponent("ginnungagap",{init:function(){let t=this.el;if(Object(n.f)("100495__jakobthiesen__light-rain-in-forest.ogg",1),Object(n.c)()){let e=document.createElement("a-entity");e.setAttribute("particle-system",{preset:"rain",particleCount:500}),e.setAttribute("bind__position","gliderPosition"),t.appendChild(e)}const e=Object(n.c)()?1200:300;this.clouds=[];let o=this.clouds;function i(n=900+300*Math.random(),i=80){o.length>=e&&t.components.pool__clouds.returnEntity(o.shift());let r=t.components.pool__clouds.requestEntity(!0),l=0;r.setAttribute("material","opacity",l);let s=setInterval(()=>{l+=1/2400,r.setAttribute("material","opacity",l),l>=.5&&clearInterval(s)},16);AFRAME.scenes[0].emit("placeInGliderPath",{el:r,distance:n,variation:i}),r.object3D.rotation.z=2*Math.random()*Math.PI,o.push(r)}setTimeout(()=>{for(let t=Math.floor(.5*e);t>0;--t)i(200+1500*t/Math.floor(.5*e),270)},4),setInterval(i,1e3),this.armaturePosition=document.getElementById("armature").object3D.position;var r=sessionStorage.getItem("returnWorld");if(r){var l=document.getElementById("returnPortal");l.setAttribute("link","href",r),l.setAttribute("link","image",r+"screenshot.png")}setInterval(()=>{let t=document.getElementById("returnPortal");t.setAttribute("visible","true"),AFRAME.scenes[0].emit("placeInGliderPath",{el:t,distance:100,variation:45})},6e4)},play:function(){this.el.emit("launch","ginnungagap play")},tick:function(){this.clouds.forEach(t=>{if(this.armaturePosition.distanceTo(t.object3D.position)>150){let e=t.object3D.rotation.z;t.object3D.lookAt(this.armaturePosition),t.object3D.rotation.z=e}})}})},2:function(t,e){
/*!
 * Copyright 2015 Google Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
window.requestIdleCallback=window.requestIdleCallback||function(t){return setTimeout(function(){var e=Date.now();t({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(t){clearTimeout(t)}}});
//# sourceMappingURL=ginnungagap.js.map